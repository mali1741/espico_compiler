//16x16
char cursor[] = {0x22,0x22,0x22,0x22,0x22,0x22,0x22,0x22,0x20,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x20,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x20,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x20,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x20,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x20,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x20,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x20,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x20,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x20,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x20,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x20,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x20,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x20,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x22,0x22,0x22,0x22,0x22,0x22,0x22,0x22};
//16x16rle
char back[] = {0x8,0xcc,0x82,0xc8,0x6,0x88,0x83,0x8c,0xc8,0x6,0x88,0x83,0x8c,0xc8,0x6,0x88,0x83,0x8c,0xc8,0x6,0x88,0x83,0x8c,0xc8,0x6,0x88,0x83,0x8c,0xc8,0x6,0x88,0x83,0x8c,0xc8,0x6,0x88,0x83,0x8c,0xc8,0x6,0x88,0x83,0x8c,0xc8,0x6,0x88,0x83,0x8c,0xc8,0x6,0x88,0x83,0x8c,0xc8,0x6,0x88,0x83,0x8c,0xc8,0x6,0x88,0x83,0x8c,0xc8,0x6,0x88,0x83,0x8c,0xc8,0x6,0x88,0x82,0x8c,0x8,0xcc};
char img0[] = {0x8,0xcc,0x82,0xc1,0x6,0x11,0x85,0x1c,0xc1,0x0,0x1,0x4,0x11,0x85,0x1c,0xc1,0x7,0x70,0x4,0x11,0x86,0x1c,0xc1,0x7,0x87,0x1,0x3,0x11,0x86,0x1c,0xc1,0x10,0x78,0x70,0x3,0x11,0x87,0x1c,0xc1,0x11,0x7,0x87,0x1,0x2,0x11,0x87,0x1c,0xc1,0x11,0x10,0x78,0x70,0x2,0x11,0x83,0x1c,0xc1,0x2,0x11,0x87,0x7,0x87,0x1,0x8,0x1c,0xc1,0x2,0x11,0x83,0x10,0x78,0x2,0x70,0x83,0x1c,0xc1,0x3,0x11,0x2,0x7,0x84,0x1,0x1c,0xc1,0x3,0x11,0x86,0x10,0x70,0x81,0x1c,0xc1,0x3,0x11,0x86,0x7,0x8,0x78,0x1c,0xc1,0x3,0x11,0x86,0x80,0x11,0x80,0x1c,0xc1,0x6,0x11,0x82,0x1c,0x8,0xcc};
char img1[] = {0x8,0xcc,0x82,0xc1,0x6,0x11,0x83,0x1c,0xc1,0x2,0x11,0x83,0x99,0x91,0x2,0x11,0x87,0x1c,0xc1,0x11,0x10,0xdd,0xd9,0x2,0x11,0x85,0x1c,0xc1,0x10,0x9,0x2,0xdd,0x90,0x91,0x11,0x1c,0xc1,0x9,0x99,0xd9,0xdd,0xd9,0x11,0x1c,0xc1,0xb,0x99,0xbd,0x2,0xdd,0x8e,0x91,0x1c,0xc1,0x9,0xb9,0x99,0x9d,0xdd,0xd9,0x1c,0xc1,0x10,0x9b,0x2,0x99,0x82,0xdf,0x2,0x1c,0x92,0xc1,0x11,0x9,0xb9,0x99,0xc1,0xfc,0x1c,0xc1,0x11,0x10,0x9b,0x9c,0x10,0x11,0x1c,0xc1,0x2,0x11,0x82,0x9,0x2,0x1,0x84,0x11,0x1c,0xc1,0x2,0x11,0x83,0x10,0xc,0x2,0x11,0x83,0x1c,0xc1,0x6,0x11,0x83,0x1c,0xc1,0x6,0x11,0x82,0x1c,0x8,0xcc};
char img2[] = {0x8,0xcc,0x82,0xc1,0x6,0x11,0x8d,0x1c,0xc1,0x11,0x17,0x7a,0xaa,0xa1,0x11,0x1c,0xc1,0x11,0x1c,0x2,0x88,0x87,0xb1,0x11,0x1c,0xc1,0x11,0xb1,0x2,0x11,0x98,0x1b,0x11,0x1c,0xc1,0x11,0x1b,0xb1,0x1f,0xb1,0x11,0x1c,0xc1,0x11,0xc1,0x11,0xf1,0x1b,0x11,0x1c,0xc1,0x1c,0x11,0x1f,0x2,0x11,0x83,0xb1,0x1c,0x2,0xc1,0x3,0x33,0x84,0x66,0x1b,0x1c,0x2,0xc1,0x2,0x33,0x85,0x36,0x66,0x1b,0x1c,0x2,0xc1,0x92,0x63,0x33,0x66,0x63,0x1b,0x1c,0xc1,0x1b,0x16,0x36,0x66,0x31,0xb1,0x1c,0xc1,0x11,0xb1,0x2,0x66,0x87,0x1b,0x11,0x1c,0xc1,0x11,0x1b,0x2,0xbb,0x85,0xb1,0x11,0x1c,0xc1,0x6,0x11,0x82,0x1c,0x8,0xcc};
char img3[] = {0x8,0xcc,0x82,0xc1,0x6,0x11,0x8c,0x1c,0xc1,0x1a,0xaa,0xac,0xaa,0xcb,0xb1,0x1c,0xc1,0x1a,0x3,0x77,0x87,0x7a,0xb1,0x1c,0xc1,0x1a,0x79,0x2,0x99,0xbd,0x9a,0xb1,0x1c,0xc1,0x1a,0x79,0x49,0x48,0xba,0xb1,0x1c,0xc1,0x1a,0x79,0x49,0x48,0xba,0xb1,0x1c,0xc1,0x1a,0x79,0x49,0x88,0xba,0xb1,0x1c,0xc1,0x1c,0x79,0x48,0x88,0xba,0xb1,0x1c,0xc1,0x1a,0x79,0x44,0x88,0xba,0xb1,0x1c,0xc1,0x11,0xa7,0x94,0x4b,0xab,0x11,0x1c,0xc1,0x11,0x1c,0x7b,0x4a,0xb1,0x11,0x1c,0xc1,0x2,0x11,0x83,0xc7,0x7b,0x2,0x11,0x83,0x1c,0xc1,0x2,0x11,0x83,0x1b,0xb1,0x2,0x11,0x83,0x1c,0xc1,0x6,0x11,0x82,0x1c,0x8,0xcc};
char img4[] = {0x8,0xcc,0x82,0xc1,0x2,0x11,0x97,0x4b,0x11,0xb1,0x11,0x1c,0xc1,0x11,0x14,0xff,0xbb,0xfb,0x11,0x1c,0xc1,0x11,0x14,0xfc,0xff,0xc9,0xb1,0x1c,0xc1,0x2,0x11,0xa0,0x4f,0xcc,0x99,0xb1,0x1c,0xc1,0x11,0x14,0x6f,0xff,0x66,0x11,0x1c,0xc1,0x11,0x4c,0xc6,0x66,0x9b,0x11,0x1c,0xc1,0x14,0xcf,0x6c,0xc6,0x99,0xb1,0x1c,0xc1,0x4c,0x2,0xff,0x87,0xc6,0xc9,0x9b,0x1c,0xc1,0x4c,0x2,0xff,0x8f,0xcc,0x99,0x9b,0x1c,0xc1,0x4c,0xcf,0xfc,0xc9,0x99,0x9b,0x1c,0xc1,0x14,0x2,0xcc,0x2,0x99,0x86,0xb1,0x1c,0xc1,0x11,0x4b,0x2,0x99,0x85,0xbb,0x11,0x1c,0xc1,0x2,0x11,0x2,0xbb,0x2,0x11,0x83,0x1c,0xc1,0x6,0x11,0x82,0x1c,0x8,0xcc};
char img5[] = {0x8,0xcc,0x82,0xc1,0x6,0x11,0x85,0x1c,0xc1,0x11,0x13,0x2,0x33,0x8f,0x31,0x11,0x1c,0xc1,0x11,0x3e,0xee,0x11,0x13,0x11,0x1c,0xc1,0x13,0xee,0x2,0x33,0x8e,0x11,0x31,0x1c,0xc1,0x13,0xe3,0xee,0xe1,0x11,0x31,0x1c,0xc1,0x13,0x2,0xee,0x82,0x1e,0x2,0x31,0x87,0x1c,0xc1,0x16,0xe3,0xee,0xe3,0x2,0x31,0x87,0x1c,0xc1,0x16,0xe3,0x3e,0xe3,0x2,0x31,0x87,0x1c,0xc1,0x16,0x36,0x3e,0xe3,0x2,0x31,0x84,0x1c,0xc1,0x16,0x2,0x63,0x89,0xee,0x3e,0x31,0x1c,0xc1,0x16,0x36,0x3e,0x2,0xee,0x86,0x31,0x1c,0xc1,0x11,0x63,0x2,0xee,0x87,0xe6,0x11,0x1c,0xc1,0x11,0x16,0x2,0x66,0x85,0x61,0x11,0x1c,0xc1,0x6,0x11,0x82,0x1c,0x8,0xcc};
char img6[] = {0x8,0xcc,0x82,0xc1,0x6,0x11,0x83,0x1c,0xc1,0x6,0x11,0x83,0x1c,0xc1,0x4,0x11,0x85,0x19,0x11,0x1c,0xc1,0x4,0x11,0x85,0x99,0xb1,0x1c,0xc1,0x3,0x11,0x86,0x19,0x9b,0xc1,0x1c,0xc1,0x3,0x11,0x86,0x99,0xb1,0xbc,0x1c,0xc1,0x2,0x11,0x88,0x19,0x9b,0xc1,0x1b,0x1c,0xc1,0x11,0x2,0xb9,0x89,0xb1,0xbc,0x11,0x1c,0xc1,0x19,0x99,0xcb,0x3,0x11,0x86,0x1c,0xc1,0x19,0x91,0xcb,0x3,0x11,0x86,0x1c,0xc1,0x19,0xcc,0xcb,0x3,0x11,0x86,0x1c,0xc1,0x11,0xbb,0xb1,0x3,0x11,0x83,0x1c,0xc1,0x6,0x11,0x83,0x1c,0xc1,0x6,0x11,0x82,0x1c,0x8,0xcc};
char img7[] = {0x8,0xcc,0x82,0xc1,0x6,0x11,0x83,0x1c,0xc1,0x3,0x11,0xa0,0x48,0x14,0x11,0x1c,0xc1,0x11,0x44,0x14,0x77,0xa7,0x41,0x1c,0xc1,0x14,0x77,0xa7,0x74,0x17,0x78,0x1c,0xc1,0x1a,0x74,0x18,0x41,0x14,0xa7,0x4c,0xc1,0x47,0x41,0x3,0x11,0x86,0x87,0x4c,0xc1,0x47,0x41,0x3,0x11,0x85,0x47,0x8c,0xc1,0x1a,0x3,0x11,0x87,0x18,0x7a,0x1c,0xc1,0x47,0x41,0x2,0x11,0x87,0x14,0x74,0x1c,0xc1,0x47,0x41,0x2,0x11,0x95,0x1a,0x74,0x1c,0xc1,0x18,0xaa,0x81,0x14,0x7a,0x81,0x1c,0xc1,0x11,0x18,0xa7,0x77,0x41,0x11,0x1c,0xc1,0x2,0x11,0x83,0xaa,0xa7,0x2,0x11,0x83,0x1c,0xc1,0x6,0x11,0x82,0x1c,0x8,0xcc};

int image[] = {img0, img1, img2, img3, img4, img5, img6, img7};

char table[48];
char isOpen[48];
char opened[2];

int i,r,b,key,prevkey,x,y,open,count,time,step;

void redraw(){
	for(i = 0; i < 48; i++){
		if(isOpen[i])
			putimagerle(image[table[i]], (i % 8) * 16, 4 + (i / 8) * 16, 16, 16);
		else
			putimagerle(back, (i % 8) * 16, 4 + (i / 8) * 16, 16, 16);
	}
}

void init(){
	x = 0;
	y = 0;
	open = 0;
	count = 48;
	time = 0;
	step = 0;
	getsprite(0, cursor);
	spritesetvalue(0, S_WIDTH, 16);
	spritesetvalue(0, S_HEIGHT, 16);
	putsprite(0, 0, 4);
	for(i = 0; i < 48; i++){
		table[i] = i % 8;
		isOpen[i] = 0;
	}
	for(i = 0; i < 48; i++){
		b = table[i];
		r = random(47);
		table[i] = table[r];
		table[r] = b;
	}
	redraw();
}

void action(){
	key = getkey();
	if(key != prevkey){
		if(key == KEY_LEFT){
			if(x > 0)
				x--;
		}
		else if(key == KEY_RIGHT){
			if(x < 7)
				x++;
		}
		if(key == KEY_UP){
			if(y > 0)
				y--;
		}
		else if(key == KEY_DOWN){
			if(y < 5)
				y++;
		}
		else if(key == KEY_A || key == KEY_B){
			if(open >= 2){
				if(table[(opened[0])] != table[(opened[1])]){
					isOpen[(opened[0])] = 0;
					isOpen[(opened[1])] = 0;
				}
				else
					count -= 2;
				open = 0;
			}
			b = y * 8 + x;
			if(isOpen[b] == 0){
				step++;
				isOpen[b] = 1;
				opened[open] = b;
				open++;
				redraw();
			}
		}
		putsprite(0, x * 16, 4 + y * 16);
	}
	prevkey = key;
}

void printTime(){
	if(gettimer(0) == 0){
		settimer(0, 1000);
		time++;
		gotoxy(1,13);
		printf("step %d   ", step);
		gotoxy(14,13);
		printf("%d:%d ", time / 60, time % 60);
	}
}

void main(){
	while(1){
		init();
		while(count){
			action();
			if(count > 2)
				printTime();
			delayredraw();
		}
	}
}
					